import{j as i,c as a,b as n,ag as l}from"./chunks/framework.CPnt7f93.js";const y=JSON.parse('{"title":"UART 代码分析","description":"","frontmatter":{},"headers":[],"relativePath":"arduino/2.uart.md","filePath":"arduino/2.uart.md","lastUpdated":1761651013000}'),p={name:"arduino/2.uart.md"};function h(k,s,e,t,r,d){return n(),a("div",null,[...s[0]||(s[0]=[l(`<h1 id="uart-代码分析" tabindex="-1">UART 代码分析 <a class="header-anchor" href="#uart-代码分析" aria-label="Permalink to &quot;UART 代码分析&quot;">​</a></h1><nav class="table-of-contents"><ul><li><a href="#串口裸板开发">串口裸板开发</a></li><li><a href="#arduino-esp32-串口编程">Arduino ESP32 串口编程</a></li><li><a href="#参考文档">参考文档</a></li></ul></nav><h2 id="串口裸板开发" tabindex="-1">串口裸板开发 <a class="header-anchor" href="#串口裸板开发" aria-label="Permalink to &quot;串口裸板开发&quot;">​</a></h2><h2 id="arduino-esp32-串口编程" tabindex="-1">Arduino ESP32 串口编程 <a class="header-anchor" href="#arduino-esp32-串口编程" aria-label="Permalink to &quot;Arduino ESP32 串口编程&quot;">​</a></h2><p>使用方法:</p><table tabindex="0"><thead><tr><th>函数名称</th><th>函数功能</th></tr></thead><tbody><tr><td>Serial. begin( )</td><td>括号内填设定的波特率</td></tr><tr><td>Serial.println( “data” )</td><td>从串行端口输出数据，跟随一个回车（ASCII 13, 或 &#39;r&#39;）和一个换行符（ASCII 10, 或 &#39;n&#39;）。这个函数所取得的值与 Serial.print()一样。</td></tr><tr><td>Serial.println(b)</td><td>以十进制形式输出b的ASCII编码值，并同时跟随一个回车和换行符。</td></tr><tr><td>Serial.println(b, DEC)</td><td>以十进制形式输出b的ASCII编码值，并同时跟随一个回车和换行符。</td></tr><tr><td>Serial.println(b, HEX)</td><td>以十六进数据形式输出b的ASCII编码值，并同时跟随一个回车和换行符。</td></tr><tr><td>Serial.println(b, OCT)</td><td>以八进数据形式输出b的ASCII编码值，并同时跟随一个回车和换行符。</td></tr><tr><td>Serial.println(b, BIN)</td><td>以二进数据形式输出b的ASCII编码值，并同时跟随一个回车和换行符。</td></tr><tr><td>Serial.print(b, BYTE)</td><td>以单个字节输出b，并同时跟随一个回车和换行符。</td></tr><tr><td>Serial.println(str)</td><td>如果 str是一个字符串或数组，输出整个 str的 ASCII编码字符串。</td></tr><tr><td>Serial.println()</td><td>仅输出一个回车和换行符。</td></tr></tbody></table><p><strong>b:需要输出的字节；</strong></p><p><strong>str:需要输出的字符串;</strong></p><p>这是 HardwareSerial.h - Hardware serial library for Wiring 文件定义的 begin 函数</p><div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> begin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> baud</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">SERIAL_8N1, </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txPin</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> invert</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> timeout_ms</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 20000</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">UL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">			uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxfifo_full_thrhd</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 112</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><table tabindex="0"><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td>baud</td><td>串口波特率，该值写0则会进入自动侦测波特率程序；</td></tr><tr><td>config</td><td>串口参数，默认SERIAL_8N1为8位数据位、无校验、1位停止位；SERIAL_8N1 = 0x800001c,</td></tr><tr><td>rxPin</td><td>接收管脚针脚号</td></tr><tr><td>txPin</td><td>发送管脚针脚号</td></tr><tr><td>invert</td><td>翻转逻辑电平，串口默认高电平为1、低电平为0（true\\fales）</td></tr><tr><td>timeout_ms</td><td>自动侦测波特率超时时间，如果超过该时间还未获得波特率就不会使能串口</td></tr><tr><td>rxfifo_full_thrhd</td><td>Request To Send 请求发送（RTS）的值. (这一般用于调制解调器将数据提交。)</td></tr></tbody></table><p>注: 调制解调器最早的是用于上网的设备。外接设备需要接到pc机上的串口上. 速率最快的为 56Kbps, 速度最慢的为 2400bps.</p><p>串口其他函数功能</p><table tabindex="0"><thead><tr><th>函数名称</th><th>函数功能</th></tr></thead><tbody><tr><td>void end();</td><td>失能串口，释放资源</td></tr><tr><td>void updateBaudRate (unsigned long baud);</td><td>重新设置波特率</td></tr><tr><td>int available (void);</td><td>返回接收缓存可读取字节数</td></tr><tr><td>int availableForWrite (void);</td><td>ESP32默认有128字节的硬件TX FIFO，该方法返回TX FIFO空闲字节数</td></tr><tr><td>int peek (void);</td><td>返回接收缓存中第一个字节数据，但并不从中删除它</td></tr><tr><td>int read (void)；</td><td>返回接收缓存中第一个字节数据，读取过的数据将从接收缓存中清除</td></tr><tr><td>void flush (void);</td><td>等待串口收发完毕</td></tr><tr><td>size_t write (uint8_t);</td><td>写数据到TX FIFO，在发送FIFO中的数据会自动输出到TX端口上。该方法有很多重载，可以用来发送字符串、长整型、整形。如果TX FIFO已满，则该方法将阻塞</td></tr><tr><td>size_t write (const uint8_t *buffer, size_t size);</td><td>写数据到TX FIFO，如果发送FIFO已满，则该方法将阻塞</td></tr><tr><td>uint32_t baudRate ();</td><td>返回当前串口波特率</td></tr><tr><td>size_t setRxBufferSize (size_t);</td><td>设置接收缓存大小（默认为256字节）ESP32默认有128字节的硬件RX FIFO，在RX FIFO收到数据后会移送到上面的接收缓存中</td></tr><tr><td>void setDebugOutput (bool);</td><td>设置该串口打印Debug信息(默认为0，失能后也会置为0)；这个方法是用来设置从哪个串口打印的，需要在Arduino IDE&gt;工具中启用Debug才会真正打印信息；（这里有一点点问题，这个库里如果没有别的串口用于打印调试信息，则Serial，即uart0一定会被用于打印调试信息，并且至少会打印Error信息）</td></tr></tbody></table><details class="details custom-block"><summary>HardwareSerial.h</summary><div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> HardwareSerial.h - Hardware serial library for Wiring</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Copyright (c) 2006 Nicholas Zambetti.  All right reserved.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> This library is free software; you can redistribute it and/or</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> modify it under the terms of the GNU Lesser General Public</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> License as published by the Free Software Foundation; either</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> version 2.1 of the License, or (at your option) any later version.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> This library is distributed in the hope that it will be useful,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Lesser General Public License for more details.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> You should have received a copy of the GNU Lesser General Public</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> License along with this library; if not, write to the Free Software</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Modified 28 September 2010 by Mark Sproul</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Modified 14 August 2012 by Alarus</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Modified 3 December 2013 by Matthijs Kooijman</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Modified 18 December 2014 by Ivan Grokhotkov (esp8266 platform support)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Modified 31 March 2015 by Markus Sattler (rewrite the code for UART0 + UART1 support in ESP8266)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Modified 25 April 2015 by Thomas Flayols (add configuration different from 8N1 in ESP8266)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Modified 13 October 2018 by Jeroen Döll (add baudrate detection)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Baudrate detection example usage (detection on Serial1):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   void setup() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     Serial.begin(115200);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     delay(100);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     Serial.println();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     Serial1.begin(0, SERIAL_8N1, -1, -1, true, 11000UL);  // Passing 0 for baudrate to detect it, the last parameter is a timeout in ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     unsigned long detectedBaudRate = Serial1.baudRate();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     if(detectedBaudRate) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       Serial.printf(&quot;Detected baudrate is %lu\\n&quot;, detectedBaudRate);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     } else {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       Serial.println(&quot;No baudrate detected, Serial1 will not work!&quot;);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> Pay attention: the baudrate returned by baudRate() may be rounded, eg 115200 returns 115201</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial_h</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial_h</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &lt;inttypes.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &lt;functional&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;Stream.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;esp32-hal.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;soc/soc_caps.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;HWCDC.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;freertos/FreeRTOS.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;freertos/task.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;freertos/semphr.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> enum</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    UART_NO_ERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    UART_BREAK_ERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    UART_BUFFER_FULL_ERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    UART_FIFO_OVF_ERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    UART_FRAME_ERROR</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    UART_PARITY_ERROR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">} </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">hardwareSerial_error_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">typedef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::function</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> OnReceiveCb;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">typedef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> std</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::function</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">hardwareSerial_error_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> OnReceiveErrorCb;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Stream</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">public:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart_nr</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    ~HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // setRxTimeout sets the timeout after which onReceive callback will be called (after receiving data, it waits for this time of UART rx inactivity to call the callback fnc)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // param symbols_timeout defines a timeout threshold in uart symbol periods. Setting 0 symbol timeout disables the callback call by timeout.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //                       Maximum timeout setting is calculacted automatically by IDF. If set above the maximum, it is ignored and an error is printed on Serial0 (check console).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //                       Examples: Maximum for 11 bits symbol is 92 (SERIAL_8N2, SERIAL_8E1, SERIAL_8O1, etc), Maximum for 10 bits symbol is 101 (SERIAL_8N1).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //                       For example symbols_timeout=1 defines a timeout equal to transmission time of one symbol (~11 bit) on current baudrate. </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //                       For a baudrate of 9600, SERIAL_8N1 (10 bit symbol) and symbols_timeout = 3, the timeout would be 3 / (9600 / 10) = 3.125 ms</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> setRxTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> symbols_timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // setRxFIFOFull(uint8_t fifoBytes) will set the number of bytes that will trigger UART_INTR_RXFIFO_FULL interrupt and fill up RxRingBuffer</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // This affects some functions such as Serial::available() and Serial.read() because, in a UART flow of receiving data, Serial internal </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // RxRingBuffer will be filled only after these number of bytes arrive or a RX Timeout happens.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // This parameter can be set to 1 in order to receive byte by byte, but it will also consume more CPU time as the ISR will be activates often.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> setRxFIFOFull</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> fifoBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // onReceive will setup a callback that will be called whenever an UART interruption occurs (UART_INTR_RXFIFO_FULL or UART_INTR_RXFIFO_TOUT)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // UART_INTR_RXFIFO_FULL interrupt triggers at UART_FULL_THRESH_DEFAULT bytes received (defined as 120 bytes by default in IDF)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // UART_INTR_RXFIFO_TOUT interrupt triggers at UART_TOUT_THRESH_DEFAULT symbols passed without any reception (defined as 10 symbos by default in IDF)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // onlyOnTimeout parameter will define how onReceive will behave:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Default: true -- The callback will only be called when RX Timeout happens. </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //                  Whole stream of bytes will be ready for being read on the callback function at once.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //                  This option may lead to Rx Overflow depending on the Rx Buffer Size and number of bytes received in the streaming</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //         false -- The callback will be called when FIFO reaches 120 bytes and also on RX Timeout.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //                  The stream of incommig bytes will be &quot;split&quot; into blocks of 120 bytes on each callback.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //                  This option avoid any sort of Rx Overflow, but leaves the UART packet reassembling work to the Application.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> onReceive</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">OnReceiveCb</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> onlyOnTimeout</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // onReceive will be called on error events (see hardwareSerial_error_t)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> onReceiveError</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">OnReceiveErrorCb</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // eventQueueReset clears all events in the queue (the events that trigger onReceive and onReceiveError) - maybe usefull in some use cases</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> eventQueueReset</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> begin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> baud</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> config</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">SERIAL_8N1, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txPin</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> invert</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> timeout_ms</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 20000</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">UL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxfifo_full_thrhd</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 112</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> end</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> fullyTerminate</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> updateBaudRate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> baud</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> available</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> availableForWrite</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> peek</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> read</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> read</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    inline</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> read</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> read</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) buffer, size);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Overrides Stream::readBytes() to be faster using IDF</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> readBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> readBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> readBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) buffer, length);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> flush</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> flush</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">( </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    inline</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) buffer, size);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    inline</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> s</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) s, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">strlen</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(s));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    inline</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) n);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    inline</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">long</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) n);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    inline</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) n);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    inline</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> n</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) n);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    uint32_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> baudRate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    operator</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> setDebugOutput</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> setRxInvert</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Negative Pin Number will keep it unmodified, thus this function can set individual pins</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // SetPins shall be called after Serial begin()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> setPins</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> ctsPin</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rtsPin</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Enables or disables Hardware Flow Control using RTS and/or CTS pins (must use setAllPins() before)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> setHwFlowCtrlMode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> mode</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> HW_FLOWCTRL_CTS_RTS, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> threshold</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 64</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // 64 is half FIFO Length</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Used to set RS485 modes such as UART_MODE_RS485_HALF_DUPLEX for Auto RTS function on ESP32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> setMode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> mode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> setRxBufferSize</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> new_size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> setTxBufferSize</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> new_size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">protected:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _uart_nr;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _uart;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _rxBufferSize;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _txBufferSize;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    OnReceiveCb _onReceiveCB;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    OnReceiveErrorCb _onReceiveErrorCB;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // _onReceive and _rxTimeout have be consistent when timeout is disabled</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _onReceiveTimeout;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _rxTimeout, _rxFIFOFull;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    TaskHandle_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _eventTask;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CONFIG_DISABLE_HAL_LOCKS</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    SemaphoreHandle_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _lock;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    int8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _rxPin, _txPin, _ctsPin, _rtsPin;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> _createEventTask</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> _destroyEventTask</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    static</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> _uartEventTask</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">extern</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> serialEventRun</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">__attribute__</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((weak));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !defined</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NO_GLOBAL_INSTANCES</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !defined</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NO_GLOBAL_SERIAL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ARDUINO_USB_CDC_ON_BOOT</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ARDUINO_USB_CDC_ON_BOOT</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ARDUINO_USB_CDC_ON_BOOT</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //Serial used for USB CDC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">ARDUINO_USB_MODE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;USB.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;USBCDC.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">extern</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> HardwareSerial Serial0;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">extern</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> HardwareSerial Serial;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">extern</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> HardwareSerial Serial1;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">extern</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> HardwareSerial Serial2;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // HardwareSerial_h</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br></div></div></details><details class="details custom-block"><summary>HardwareSerial.cpp</summary><div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &lt;stdlib.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &lt;stdio.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &lt;string.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &lt;inttypes.h&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;pins_arduino.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;io_pin_remap.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;HardwareSerial.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;soc/soc_caps.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;driver/uart.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;freertos/queue.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ARDUINO_SERIAL_EVENT_TASK_STACK_SIZE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ARDUINO_SERIAL_EVENT_TASK_STACK_SIZE</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2048</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ARDUINO_SERIAL_EVENT_TASK_PRIORITY</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ARDUINO_SERIAL_EVENT_TASK_PRIORITY</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">configMAX_PRIORITIES</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">-1)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ARDUINO_SERIAL_EVENT_TASK_RUNNING_CORE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ARDUINO_SERIAL_EVENT_TASK_RUNNING_CORE</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_RX0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_RX0</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32S2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32S3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_RX0</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 44</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32C3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_RX0</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 20</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_TX0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_TX0</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32S2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32S3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_TX0</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 43</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32C3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_TX0</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 21</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> serialEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">__attribute__</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((weak));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> serialEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> RX1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> RX1</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 9</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32S2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> RX1</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 18</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32C3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> RX1</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 18</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32S3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> RX1</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 15</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> TX1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> TX1</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 10</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32S2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> TX1</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 17</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32C3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> TX1</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 19</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32S3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> TX1</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 16</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> serialEvent1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">__attribute__</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((weak));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> serialEvent1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* SOC_UART_NUM &gt; 1 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> RX2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> RX2</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 16</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32S3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> RX2</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 19</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> TX2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> TX2</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 17</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> CONFIG_IDF_TARGET_ESP32S3</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> TX2</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 20</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> serialEvent2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">__attribute__</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((weak));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> serialEvent2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* SOC_UART_NUM &gt; 2 */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !defined</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NO_GLOBAL_INSTANCES</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !defined</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">NO_GLOBAL_SERIAL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ARDUINO_USB_CDC_ON_BOOT</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //Serial used for USB CDC</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HardwareSerial</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Serial0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HardwareSerial</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Serial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HardwareSerial</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Serial1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HardwareSerial</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> Serial2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> serialEventRun</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> ARDUINO_USB_CDC_ON_BOOT</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> //Serial used for USB CDC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(Serial0.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">available</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">serialEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(Serial.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">available</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">serialEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(Serial1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">available</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">serialEvent1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(Serial2.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">available</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">serialEvent2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CONFIG_DISABLE_HAL_LOCKS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HSERIAL_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()    </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {} </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">while</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">xSemaphoreTake</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_lock, portMAX_DELAY) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> pdPASS)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HSERIAL_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">xSemaphoreGive</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_lock)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HSERIAL_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HSERIAL_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart_nr) : </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_uart_nr</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart_nr), </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_rxBufferSize</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_txBufferSize</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">), </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_onReceiveCB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">), </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_onReceiveErrorCB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_onReceiveTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_rxTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_rxFIFOFull</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_eventTask</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CONFIG_DISABLE_HAL_LOCKS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    ,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_lock</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_txPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_ctsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_rtsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CONFIG_DISABLE_HAL_LOCKS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        _lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> xSemaphoreCreateMutex</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;xSemaphoreCreateMutex failed&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">~</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    end</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CONFIG_DISABLE_HAL_LOCKS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        vSemaphoreDelete</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_lock);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_createEventTask</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Creating UART event Task</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    xTaskCreateUniversal</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uartEventTask, </span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;uart_event_task&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, ARDUINO_SERIAL_EVENT_TASK_STACK_SIZE, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, ARDUINO_SERIAL_EVENT_TASK_PRIORITY, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">_eventTask, ARDUINO_SERIAL_EVENT_TASK_RUNNING_CORE);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_eventTask </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot; -- UART</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> Event Task not Created!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, _uart_nr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_destroyEventTask</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_eventTask </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        vTaskDelete</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_eventTask);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        _eventTask </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">onReceiveError</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">OnReceiveErrorCb</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    HSERIAL_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // function may be NULL to cancel onReceive() from its respective task </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    _onReceiveErrorCB </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> function;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // this can be called after Serial.begin(), therefore it shall create the event task</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (function </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _eventTask </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        _createEventTask</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    HSERIAL_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">onReceive</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">OnReceiveCb</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> onlyOnTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    HSERIAL_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // function may be NULL to cancel onReceive() from its respective task </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    _onReceiveCB </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> function;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // setting the callback to NULL will just disable it</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_onReceiveCB </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // When Rx timeout is Zero (disabled), there is only one possible option that is callback when FIFO reaches 120 bytes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        _onReceiveTimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _rxTimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ?</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> onlyOnTimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // in case that onReceive() shall work only with RX Timeout, FIFO shall be high</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // this is a work around for an IDF issue with events and low FIFO Full value (&lt; 3)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_onReceiveTimeout) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            uartSetRxFIFOFull</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">120</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            log_w</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;OnReceive is set to Timeout only, thus FIFO Full is now 120 bytes.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // this method can be called after Serial.begin(), therefore it shall create the event task</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _eventTask </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            _createEventTask</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // Create event task</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    HSERIAL_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This function allow the user to define how many bytes will trigger an Interrupt that will copy RX FIFO to the internal RX Ringbuffer</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ISR will also move data from FIFO to RX Ringbuffer after a RX Timeout defined in HardwareSerial::setRxTimeout(uint8_t symbols_timeout)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// A low value of FIFO Full bytes will consume more CPU time within the ISR</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// A high value of FIFO Full bytes will make the application wait longer to have byte available for the Stkech in a streaming scenario</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Both RX FIFO Full and RX Timeout may affect when onReceive() will be called</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">setRxFIFOFull</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> fifoBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    HSERIAL_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // in case that onReceive() shall work only with RX Timeout, FIFO shall be high</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // this is a work around for an IDF issue with events and low FIFO Full value (&lt; 3)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_onReceiveCB </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _onReceiveTimeout) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        fifoBytes </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_w</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;OnReceive is set to Timeout only, thus FIFO Full is now 120 bytes.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetRxFIFOFull</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, fifoBytes);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // Set new timeout</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (fifoBytes </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fifoBytes </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> SOC_UART_FIFO_LEN </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) _rxFIFOFull </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fifoBytes;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    HSERIAL_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// timout is calculates in time to receive UART symbols at the UART baudrate.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// the estimation is about 11 bits per symbol (SERIAL_8N1)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">setRxTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> symbols_timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    HSERIAL_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Zero disables timeout, thus, onReceive callback will only be called when RX FIFO reaches 120 bytes</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Any non-zero value will activate onReceive callback based on UART baudrate with about 11 bits per symbol </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    _rxTimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> symbols_timeout;   </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">symbols_timeout) _onReceiveTimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // only when RX timeout is disabled, we also must disable this flag </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetRxTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, _rxTimeout);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // Set new timeout</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    HSERIAL_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">eventQueueReset</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    QueueHandle_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uartEventQueue </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uartGetEventQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">uartEventQueue);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (uartEventQueue </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        xQueueReset</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uartEventQueue);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_uartEventTask</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    HardwareSerial </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (HardwareSerial </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)args;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    uart_event_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> event;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    QueueHandle_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uartEventQueue </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uartGetEventQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;_uart, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">uartEventQueue);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (uartEventQueue </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(;;) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            //Waiting for UART event.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">xQueueReceive</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uartEventQueue, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> )</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">event, (portTickType)portMAX_DELAY)) {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">                hardwareSerial_error_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> currentErr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_NO_ERROR;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                switch</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(event.type) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                    case</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_DATA:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;_onReceiveCB </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">available</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                            ((uart-&gt;_onReceiveTimeout </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> event.timeout_flag) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">||</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">uart-&gt;_onReceiveTimeout) ) </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                                uart-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_onReceiveCB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                    case</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_FIFO_OVF:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">                        log_w</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;UART</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> FIFO Overflow. Consider adding Hardware Flow Control to your Application.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, uart-&gt;_uart_nr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                        currentErr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_FIFO_OVF_ERROR;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                    case</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_BUFFER_FULL:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">                        log_w</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;UART</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> Buffer Full. Consider increasing your buffer size of your Application.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, uart-&gt;_uart_nr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                        currentErr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_BUFFER_FULL_ERROR;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                    case</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_BREAK:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">                        log_w</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;UART</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> RX break.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, uart-&gt;_uart_nr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                        currentErr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_BREAK_ERROR;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                    case</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_PARITY_ERR:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">                        log_w</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;UART</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> parity error.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, uart-&gt;_uart_nr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                        currentErr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_PARITY_ERROR;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                    case</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_FRAME_ERR:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">                        log_w</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;UART</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> frame error.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, uart-&gt;_uart_nr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                        currentErr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_FRAME_ERROR;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                    default</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">                        log_w</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;UART</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> unknown event type </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, uart-&gt;_uart_nr, event.type);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                        break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (currentErr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_NO_ERROR) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;_onReceiveErrorCB) uart-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_onReceiveErrorCB</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(currentErr);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    vTaskDelete</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">begin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> baud</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> config</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> invert</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> timeout_ms</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxfifo_full_thrhd</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _uart_nr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _uart_nr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> SOC_UART_NUM) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;Serial number is invalid, please use numers from 0 to </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%u</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, SOC_UART_NUM </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CONFIG_DISABLE_HAL_LOCKS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;MUTEX Lock failed. Can&#39;t begin.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    HSERIAL_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // First Time or after end() --&gt; set default Pins</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uartIsDriverInstalled</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        switch</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_uart_nr) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            case</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_NUM_0:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">                if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                    rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> SOC_RX0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                    txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> SOC_TX0;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                   // may save some flash bytes...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            case</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_NUM_1:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">               if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                    rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> RX1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                    txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> TX1;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                   // may save some flash bytes...</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            case</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_NUM_2:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">               if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                    rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> RX2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                    txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> TX2;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // map logical pins to GPIO numbers</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> digitalPinToGPIONumber</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(rxPin);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> digitalPinToGPIONumber</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(txPin);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // in this case it is a begin() over a previous begin() - maybe to change baud rate</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // thus do not disable debug output</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        end</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // IDF UART driver keeps Pin setting on restarting. Negative Pin number will keep it unmodified.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    _uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartBegin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart_nr, baud </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> baud </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 9600</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, config, rxPin, txPin, _rxBufferSize, _txBufferSize, invert, rxfifo_full_thrhd);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">baud) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // using baud rate as zero, forces it to try to detect the current baud rate in place</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        uartStartDetectBaudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        time_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> startMillis </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> millis</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> detectedBaudRate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        while</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">millis</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> startMillis </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> timeout_ms </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(detectedBaudRate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartDetectBaudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart))) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            yield</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        end</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(detectedBaudRate) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            delay</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // Give some time...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">            _uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartBegin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart_nr, detectedBaudRate, config, rxPin, txPin, _rxBufferSize, _txBufferSize, invert, rxfifo_full_thrhd);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;Could not detect baudrate. Serial data at the port must be present within the timeout for detection to be possible&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">            _uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // create a task to deal with Serial Events when, for example, calling begin() twice to change the baudrate,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // or when setting the callback before calling begin() </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_onReceiveCB </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _onReceiveErrorCB </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _eventTask </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        _createEventTask</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">this</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Set UART RX timeout</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uartSetRxTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, _rxTimeout);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Set UART FIFO Full depending on the baud rate. </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Lower baud rates will force to emulate byte-by-byte reading</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Higher baud rates will keep IDF default of 120 bytes for FIFO FULL Interrupt</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // It can also be changed by the application at any time </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">_rxFIFOFull) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // it has not being changed before calling begin()</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      //  set a default FIFO Full value for the IDF driver</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">      uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fifoFull </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (baud </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 57600</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_onReceiveCB </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _onReceiveTimeout)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        fifoFull </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">      uartSetRxFIFOFull</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, fifoFull);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      _rxFIFOFull </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> fifoFull;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    _rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> rxPin;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    _txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> txPin;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    HSERIAL_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">updateBaudRate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> baud</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">	uartSetBaudRate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, baud);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> fullyTerminate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // default Serial.end() will completely disable HardwareSerial, </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // including any tasks or debug message channel (log_x()) - but not for IDF log messages!</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(fullyTerminate) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        _onReceiveCB </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        _onReceiveErrorCB </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uartGetDebug</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _uart_nr) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            uartSetDebug</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        _rxFIFOFull </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">; </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        uartDetachPins</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, _rxPin, _txPin, _ctsPin, _rtsPin);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        _rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _ctsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _rtsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    delay</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uartEnd</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    _uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    _destroyEventTask</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">setDebugOutput</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> en</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(en) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        uartSetDebug</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uartGetDebug</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _uart_nr) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            uartSetDebug</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">available</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">availableForWrite</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartAvailableForWrite</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">peek</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">available</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartPeek</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> c </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uartReadBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">c, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> c;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// read characters into buffer</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// terminates if size characters have been read, or no further are pending</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// returns the number of characters placed in the buffer</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// the buffer is NOT null terminated.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">read</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartReadBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, buffer, size, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Overrides Stream::readBytes() to be faster using IDF</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">readBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> length</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartReadBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, buffer, length, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">getTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">flush</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uartFlush</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">flush</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uartFlushTxOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, txOnly);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> c</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uartWrite</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, c);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">write</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uartWriteBuf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, buffer, size);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> size;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">baudRate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">	return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartGetBaudRate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">operator</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartIsDriverInstalled</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">setRxInvert</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> invert</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uartSetRxInvert</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, invert);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// negative Pin value will keep it unmodified</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">setPins</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> ctsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rtsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;setPins() shall be called after begin() - nothing done</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // map logical pins to GPIO numbers</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> digitalPinToGPIONumber</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(rxPin);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> digitalPinToGPIONumber</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(txPin);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    ctsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> digitalPinToGPIONumber</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(ctsPin);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    rtsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> digitalPinToGPIONumber</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(rtsPin);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // uartSetPins() checks if pins are valid for each function and for the SoC</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetPins</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, rxPin, txPin, ctsPin, rtsPin);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (retCode) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        _txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ?</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _txPin;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        _rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ?</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _rxPin;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        _rtsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _rtsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ?</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> rtsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _rtsPin;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        _ctsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _ctsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ?</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ctsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _ctsPin;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;Error when setting Serial port Pins. Invalid Pin.</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Enables or disables Hardware Flow Control using RTS and/or CTS pins (must use setAllPins() before)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">setHwFlowCtrlMode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> mode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> threshold</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetHwFlowCtrlMode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, mode, threshold);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Sets the uart mode in the esp32 uart for use with RS485 modes (HwFlowCtrl must be disabled and RTS pin set)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">setMode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> mode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetMode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(_uart, mode);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">setRxBufferSize</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> new_size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_uart) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;RX Buffer can&#39;t be resized when Serial is already running.</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (new_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> SOC_UART_FIFO_LEN) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;RX Buffer must be higher than </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, SOC_UART_FIFO_LEN);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ESP32, S2, S3 and C3 means higher than 128</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    _rxBufferSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> new_size;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _rxBufferSize;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HardwareSerial</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">setTxBufferSize</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> new_size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (_uart) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;TX Buffer can&#39;t be resized when Serial is already running.</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (new_size </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> SOC_UART_FIFO_LEN) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;TX Buffer must be higher than </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, SOC_UART_FIFO_LEN);</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ESP32, S2, S3 and C3 means higher than 128</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    _txBufferSize </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> new_size;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _txBufferSize;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br><span class="line-number">569</span><br><span class="line-number">570</span><br><span class="line-number">571</span><br><span class="line-number">572</span><br><span class="line-number">573</span><br><span class="line-number">574</span><br><span class="line-number">575</span><br><span class="line-number">576</span><br><span class="line-number">577</span><br><span class="line-number">578</span><br><span class="line-number">579</span><br><span class="line-number">580</span><br><span class="line-number">581</span><br><span class="line-number">582</span><br><span class="line-number">583</span><br><span class="line-number">584</span><br><span class="line-number">585</span><br><span class="line-number">586</span><br><span class="line-number">587</span><br><span class="line-number">588</span><br><span class="line-number">589</span><br><span class="line-number">590</span><br><span class="line-number">591</span><br><span class="line-number">592</span><br><span class="line-number">593</span><br><span class="line-number">594</span><br><span class="line-number">595</span><br><span class="line-number">596</span><br><span class="line-number">597</span><br><span class="line-number">598</span><br><span class="line-number">599</span><br><span class="line-number">600</span><br><span class="line-number">601</span><br><span class="line-number">602</span><br><span class="line-number">603</span><br><span class="line-number">604</span><br><span class="line-number">605</span><br><span class="line-number">606</span><br><span class="line-number">607</span><br><span class="line-number">608</span><br><span class="line-number">609</span><br><span class="line-number">610</span><br><span class="line-number">611</span><br><span class="line-number">612</span><br><span class="line-number">613</span><br><span class="line-number">614</span><br><span class="line-number">615</span><br><span class="line-number">616</span><br><span class="line-number">617</span><br><span class="line-number">618</span><br><span class="line-number">619</span><br><span class="line-number">620</span><br><span class="line-number">621</span><br><span class="line-number">622</span><br><span class="line-number">623</span><br></div></div></details><details class="details custom-block"><summary>esp32-hal-uart.h</summary><div class="language-cpp vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">cpp</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Copyright 2015-2016 Espressif Systems (Shanghai) PTE LTD</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// you may not use this file except in compliance with the License.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// You may obtain a copy of the License at</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//     http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Unless required by applicable law or agreed to in writing, software</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// See the License for the specific language governing permissions and</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// limitations under the License.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifndef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> MAIN_ESP32_HAL_UART_H_</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> MAIN_ESP32_HAL_UART_H_</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifdef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> __cplusplus</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">extern</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;C&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &lt;stdint.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &lt;stdbool.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &lt;stdlib.h&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;freertos/FreeRTOS.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;freertos/queue.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifdef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> __cplusplus</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">enum</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SerialConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_5N1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000010</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_6N1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000014</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_7N1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000018</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_8N1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800001c</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_5N2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000030</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_6N2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000034</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_7N2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000038</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_8N2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800003c</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_5E1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000012</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_6E1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000016</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_7E1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800001a</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_8E1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800001e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_5E2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000032</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_6E2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000036</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_7E2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800003a</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_8E2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800003e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_5O1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000013</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_6O1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000017</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_7O1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800001b</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_8O1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800001f</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_5O2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000033</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_6O2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000037</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_7O2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800003b</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">SERIAL_8O2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800003f</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">};</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_5N1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000010</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_6N1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000014</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_7N1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000018</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_8N1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800001c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_5N2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000030</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_6N2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000034</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_7N2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000038</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_8N2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800003c</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_5E1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000012</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_6E1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000016</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_7E1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800001a</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_8E1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800001e</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_5E2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000032</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_6E2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000036</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_7E2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800003a</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_8E2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800003e</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_5O1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000013</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_6O1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000017</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_7O1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800001b</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_8O1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800001f</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_5O2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000033</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_6O2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">8000037</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_7O2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800003b</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SERIAL_8O2</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">800003f</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // __cplusplus</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// These are Hardware Flow Contol possible usage</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// equivalent to UDF enum uart_hw_flowcontrol_t from </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// https://github.com/espressif/esp-idf/blob/master/components/hal/include/hal/uart_types.h#L75-L81</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HW_FLOWCTRL_DISABLE</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">   0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // disable HW Flow Control</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HW_FLOWCTRL_RTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">       0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // use only RTS PIN for HW Flow Control</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HW_FLOWCTRL_CTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">       0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // use only CTS PIN for HW Flow Control</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> HW_FLOWCTRL_CTS_RTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">   0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       // use both CTS and RTS PIN for HW Flow Control</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// These are Hardware Uart Modes possible usage</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// equivalent to UDF enum uart_mode_t from</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// https://github.com/espressif/esp-idf/blob/master/components/hal/include/hal/uart_types.h#L34-L40</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> MODE_UART</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">00</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                   // mode: regular UART mode</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> MODE_RS485_HALF_DUPLEX</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">01</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // mode: half duplex RS485 UART mode control by RTS pin</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> MODE_IRDA</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">02</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                   // mode: IRDA  UART mode</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> MODE_RS485_COLLISION_DETECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">03</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // mode: RS485 collision detection UART mode (used for test purposes)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> MODE_RS485_APP_CTRL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">04</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_struct_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">typedef</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> struct</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_struct_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartBegin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart_nr</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> baudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> config</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint16_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rx_buffer_size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint16_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> tx_buffer_size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> inverted</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxfifo_full_thrhd</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartEnd</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This is used to retrieve the Event Queue pointer from a UART IDF Driver in order to allow user to deal with its events</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartGetEventQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">QueueHandle_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">q</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">); </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartAvailableForWrite</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartReadBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> timeout_ms</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartRead</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartPeek</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartWrite</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> c</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartWriteBuf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartFlush</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartFlushTxOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetBaudRate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> baud_rate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartGetBaudRate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetRxInvert</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> invert</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetRxTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> numSymbTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetRxFIFOFull</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> numBytesFIFOFull</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetFastReading</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetDebug</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartGetDebug</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartIsDriverInstalled</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Negative Pin Number will keep it unmodified, thus this function can set/reset individual pins</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetPins</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> ctsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rtsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartDetachPins</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> ctsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rtsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Enables or disables HW Flow Control function -- needs also to set CTS and/or RTS pins</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetHwFlowCtrlMode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> mode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> threshold</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Used to set RS485 function -- needs to disable HW Flow Control and set RTS pin to use</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// RTS pin becomes RS485 half duplex RE/DE</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetMode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> mode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartStartDetectBaudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartDetectBaudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    These functions are for testing puspose only and can be used in Arduino Sketches</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    Those are used in the UART examples</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Make sure UART&#39;s RX signal is connected to TX pin</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This creates a loop that lets us receive anything we send on the UART</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_internal_loopback</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uartNum</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Routines that generate BREAK in the UART for testing purpose</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Forces a BREAK in the line based on SERIAL_8N1 configuration at any baud rate</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_send_break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uartNum</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Sends a buffer and at the end of the stream, it generates BREAK in the line</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_send_msg_with_break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uartNum</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> msgSize</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifdef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> __cplusplus</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /* MAIN_ESP32_HAL_UART_H_ */</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br></div></div></details><details class="details custom-block"><summary>esp32-hal-uart.c</summary><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Copyright 2015-2016 Espressif Systems (Shanghai) PTE LTD</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// you may not use this file except in compliance with the License.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// You may obtain a copy of the License at</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//     http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Unless required by applicable law or agreed to in writing, software</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// See the License for the specific language governing permissions and</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// limitations under the License.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;esp32-hal-uart.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;esp32-hal.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;freertos/FreeRTOS.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;freertos/semphr.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;driver/uart.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;hal/uart_ll.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;soc/soc_caps.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;soc/uart_struct.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;soc/uart_periph.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;driver/gpio.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;hal/gpio_hal.h&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#include</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> &quot;esp_rom_gpio.h&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> int</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> s_uart_debug_nr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">struct</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> uart_struct_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CONFIG_DISABLE_HAL_LOCKS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    xSemaphoreHandle lock;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> num;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> has_peek;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> peek_byte;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    QueueHandle_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart_event_queue;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // export it by some uartGetEventQueue() function</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_DISABLE_HAL_LOCKS</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">static</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> uart_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _uart_bus_array</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()    </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">do</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {} </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">while</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">xSemaphoreTake</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;lock, portMAX_DELAY) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> pdPASS)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()  </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">xSemaphoreGive</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;lock)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">static</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> uart_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> _uart_bus_array</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// IDF UART has no detach function. As consequence, after ending a UART, the previous pins continue</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// to work as RX/TX. It can be verified by changing the UART pins and writing to the UART. Output can </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// be seen in the previous pins and new pins as well. </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Valid pin UART_PIN_NO_CHANGE is defined to (-1)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Negative Pin Number will keep it unmodified, thus this function can detach individual pins</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartDetachPins</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> ctsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rtsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (txPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        gpio_hal_iomux_func_sel</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">GPIO_PIN_MUX_REG</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[txPin], PIN_FUNC_GPIO);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        esp_rom_gpio_connect_out_signal</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(txPin, SIG_GPIO_OUT_IDX, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (rxPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        gpio_hal_iomux_func_sel</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">GPIO_PIN_MUX_REG</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[rxPin], PIN_FUNC_GPIO);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        esp_rom_gpio_connect_in_signal</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(GPIO_FUNC_IN_LOW, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UART_PERIPH_SIGNAL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, SOC_UART_RX_PIN_IDX), </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (rtsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        gpio_hal_iomux_func_sel</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">GPIO_PIN_MUX_REG</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[rtsPin], PIN_FUNC_GPIO);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        esp_rom_gpio_connect_out_signal</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(rtsPin, SIG_GPIO_OUT_IDX, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (ctsPin </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        gpio_hal_iomux_func_sel</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">GPIO_PIN_MUX_REG</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[ctsPin], PIN_FUNC_GPIO);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        esp_rom_gpio_connect_in_signal</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(GPIO_FUNC_IN_LOW, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UART_PERIPH_SIGNAL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, SOC_UART_CTS_PIN_IDX), </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// solves issue https://github.com/espressif/arduino-esp32/issues/6032</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// baudrate must be multiplied when CPU Frequency is lower than APB 80MHz</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> _get_effective_baudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> baudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> Freq </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> getApbFrequency</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1000000</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (Freq </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 80</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 80</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> Freq </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> baudrate;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">     }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> baudrate;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Routines that take care of UART events will be in the HardwareSerial Class code</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartGetEventQueue</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">QueueHandle_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">q</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // passing back NULL for the Queue pointer when UART is not initialized yet</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">q </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">q </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart-&gt;uart_event_queue;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartIsDriverInstalled</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_is_driver_installed</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Valid pin UART_PIN_NO_CHANGE is defined to (-1)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Negative Pin Number will keep it unmodified, thus this function can set individual pins</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetPins</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> ctsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rtsPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // IDF uart_set_pin() will issue necessary Error Message and take care of all GPIO Number validation.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_set_pin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, txPin, rxPin, rtsPin, ctsPin) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ESP_OK; </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetHwFlowCtrlMode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> mode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> threshold</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // IDF will issue corresponding error message when mode or threshold are wrong and prevent crashing</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // IDF will check (mode &gt; HW_FLOWCTRL_CTS_RTS || threshold &gt;= SOC_UART_FIFO_LEN)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (ESP_OK </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_set_hw_flow_ctrl</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, (</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_hw_flowcontrol_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) mode, threshold));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartBegin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart_nr</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> baudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> config</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint16_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rx_buffer_size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint16_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> tx_buffer_size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> inverted</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxfifo_full_thrhd</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart_nr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> SOC_UART_NUM) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">_uart_bus_array</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[uart_nr];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_is_driver_installed</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart_nr)) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        uartEnd</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CONFIG_DISABLE_HAL_LOCKS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        uart-&gt;lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> xSemaphoreCreateMutex</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;lock </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    uart_config_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart_config;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    uart_config.data_bits </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (config </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">c</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    uart_config.parity </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (config </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    uart_config.stop_bits </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (config </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">30</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    uart_config.flow_ctrl </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_HW_FLOWCTRL_DISABLE;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    uart_config.rx_flow_ctrl_thresh </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> rxfifo_full_thrhd;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_SUPPORT_XTAL_CLK</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // works independently of APB frequency</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    uart_config.source_clk </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_SCLK_XTAL;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // ESP32C3, ESP32S3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    uart_config.baud_rate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> baudrate;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    uart_config.source_clk </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_SCLK_APB;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ESP32, ESP32S2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    uart_config.baud_rate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> _get_effective_baudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(baudrate);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    ESP_ERROR_CHECK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_driver_install</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart_nr, rx_buffer_size, tx_buffer_size, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;uart_event_queue), </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    ESP_ERROR_CHECK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_param_config</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart_nr, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">uart_config));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    ESP_ERROR_CHECK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_set_pin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart_nr, txPin, rxPin, UART_PIN_NO_CHANGE, UART_PIN_NO_CHANGE));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Is it right or the idea is to swap rx and tx pins? </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (inverted) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // invert signal for both Rx and Tx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        ESP_ERROR_CHECK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_set_line_inverse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart_nr, UART_SIGNAL_TXD_INV </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_SIGNAL_RXD_INV));    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uartFlush</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This function code is under testing - for now just keep it here</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetFastReading</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // override default RX IDF Driver Interrupt - no BREAK, PARITY or OVERFLOW</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    uart_intr_config_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart_intr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        .intr_enable_mask </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_INTR_RXFIFO_FULL </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">|</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_INTR_RXFIFO_TOUT,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   // only these IRQs - no BREAK, PARITY or OVERFLOW</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        .rx_timeout_thresh </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        .txfifo_empty_intr_thresh </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 10</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        .rxfifo_full_thresh </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    ESP_ERROR_CHECK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_intr_config</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">uart_intr));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetRxTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> numSymbTimeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (ESP_OK </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_set_rx_timeout</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, numSymbTimeout));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetRxFIFOFull</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> numBytesFIFOFull</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (ESP_OK </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_set_rx_full_threshold</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, numBytesFIFOFull));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartEnd</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">   </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uart_driver_delete</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetRxInvert</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> invert</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // POTENTIAL ISSUE :: original code only set/reset rxd_inv bit </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // IDF or LL set/reset the whole inv_mask!</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    if (invert)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ESP_ERROR_CHECK(uart_set_line_inverse(uart-&gt;num, UART_SIGNAL_RXD_INV));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    else</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ESP_ERROR_CHECK(uart_set_line_inverse(uart-&gt;num, UART_SIGNAL_INV_DISABLE));</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // this implementation is better over IDF API because it only affects RXD</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // this is supported in ESP32, ESP32-S2 and ESP32-C3</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    uart_dev_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">hw </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UART_LL_GET_HW</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (invert)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        hw-&gt;conf0.rxd_inv </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    else</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        hw-&gt;conf0.rxd_inv </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartAvailable</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> available;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uart_get_buffered_data_len</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">available);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (uart-&gt;has_peek) available</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> available;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartAvailableForWrite</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> available </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  uart_ll_get_txfifo_len</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UART_LL_GET_HW</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num));  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> txRingBufferAvailable </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (ESP_OK </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_get_tx_buffer_free_size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">txRingBufferAvailable)) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        available </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> txRingBufferAvailable; </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> available;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartReadBytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">buffer</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> timeout_ms</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> size </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> buffer </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> bytes_read </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (uart-&gt;has_peek) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        uart-&gt;has_peek </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">buffer</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">++</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart-&gt;peek_byte;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        size</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        bytes_read </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (size </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">       int</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_read_bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, buffer, size, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">pdMS_TO_TICKS</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(timeout_ms));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">       if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // error reading UART</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">       bytes_read </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> len;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> bytes_read;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// DEPRICATED but the original code will be kepts here as future reference when a final solution</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// to the UART driver is defined in the use case of reading byte by byte from UART.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartRead</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> c </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (uart-&gt;has_peek) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      uart-&gt;has_peek </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      c </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart-&gt;peek_byte;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_read_bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">c, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> portTICK_RATE_MS);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // includes negative return from IDF in case of error</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">            c  </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> c;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartPeek</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    uint8_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> c </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (uart-&gt;has_peek) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">      c </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart-&gt;peek_byte;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_read_bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">c, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">20</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> portTICK_RATE_MS);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // includes negative return from IDF in case of error</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">            c  </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">            uart-&gt;has_peek </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">            uart-&gt;peek_byte </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> c;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> c;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartWrite</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> c</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uart_write_bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">c, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartWriteBuf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> data</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> data </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ||</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">len) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uart_write_bytes</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, data, len);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartFlush</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uartFlushTxOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartFlushTxOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> txOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_ll_is_tx_idle</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UART_LL_GET_HW</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num)));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ( </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">txOnly ) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        ESP_ERROR_CHECK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_flush_input</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetBaudRate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> baud_rate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uart_ll_set_baudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UART_LL_GET_HW</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">_get_effective_baudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(baud_rate));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartGetBaudRate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> baud_rate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_ll_get_baudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UART_LL_GET_HW</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> baud_rate;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ARDUINO_ISR_ATTR </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart0_write_char</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">char</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> c</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_ll_get_txfifo_len</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">UART0) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uart_ll_write_txfifo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">UART0, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">c, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ARDUINO_ISR_ATTR </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart1_write_char</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">char</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> c</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_ll_get_txfifo_len</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">UART1) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uart_ll_write_txfifo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">UART1, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">c, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ARDUINO_ISR_ATTR </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart2_write_char</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">char</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> c</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uart_ll_get_txfifo_len</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">UART2) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uart_ll_write_txfifo</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">UART2, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">c, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_install_putc</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    switch</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(s_uart_debug_nr) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    case</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        ets_install_putc1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">char</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart0_write_char</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    case </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        ets_install_putc1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">char</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart1_write_char</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    case </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        ets_install_putc1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">char</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart2_write_char</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    default</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        ets_install_putc1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Routines that take care of UART mode in the HardwareSerial Class code</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// used to set UART_MODE_RS485_HALF_DUPLEX auto RTS for TXD for ESP32 chips</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetMode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> mode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart-&gt;num </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> SOC_UART_NUM)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (ESP_OK </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_set_mode</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num, mode));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> retCode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartSetDebug</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">*</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart-&gt;num </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> SOC_UART_NUM) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        s_uart_debug_nr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        s_uart_debug_nr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uart-&gt;num;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    uart_install_putc</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartGetDebug</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> s_uart_debug_nr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> log_printfv</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, va_list </span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">arg</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    static</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> char</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> loc_buf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">64</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> temp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> loc_buf;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> len;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    va_list copy;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    va_copy</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(copy, arg);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> vsnprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, format, copy);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    va_end</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(copy);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(loc_buf)){</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        temp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">char*</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">malloc</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(len</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(temp </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CONFIG_DISABLE_HAL_LOCKS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(s_uart_debug_nr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> _uart_bus_array</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[s_uart_debug_nr].lock){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        xSemaphoreTake</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">_uart_bus_array</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[s_uart_debug_nr].lock, portMAX_DELAY);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    vsnprintf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(temp, len</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, format, arg);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    ets_printf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, temp);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">CONFIG_DISABLE_HAL_LOCKS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(s_uart_debug_nr </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &amp;&amp;</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> _uart_bus_array</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[s_uart_debug_nr].lock){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        xSemaphoreGive</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">_uart_bus_array</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[s_uart_debug_nr].lock);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(loc_buf)){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        free</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(temp);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> len;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> log_printf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> char</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, ...)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> len;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    va_list arg;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    va_start</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(arg, format);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> log_printfv</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(format, arg);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    va_end</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(arg);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> len;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> log_print_buf_line</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> total_len</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">len; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_printf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%s</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%02x</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">,&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">?</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot; &quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[i]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(total_len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 16</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> len; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            log_printf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;      &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_printf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;    // &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    } </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_printf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot; // &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">len; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_printf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%c</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">,((</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">))</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">?</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[i]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&#39;.&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    log_printf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> log_print_buf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">b</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">||</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">b){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">len; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 16</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">            log_printf</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;/* 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">%04X</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;"> */ &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, i);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        log_print_buf_line</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(b</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">i, ((len</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">i)</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(len </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> i)</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">16</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, len);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * if enough pulses are detected return the minimum high pulse duration + minimum low pulse duration divided by two. </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * This equals one bit period. If flag is true the function return inmediately, otherwise it waits for enough pulses.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartBaudrateDetect</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">bool</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> flg</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Baud rate detection only works for ESP32 and ESP32S2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ||</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32S2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    uart_dev_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">hw </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UART_LL_GET_HW</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    while</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(hw-&gt;rxd_cnt.edge_cnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 30</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // UART_PULSE_NUM(uart_num)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(flg) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        ets_delay_us</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_LOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //log_i(&quot;lowpulse_min_cnt = %d hightpulse_min_cnt = %d&quot;, hw-&gt;lowpulse.min_cnt, hw-&gt;highpulse.min_cnt);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ret </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ((hw-&gt;lowpulse.min_cnt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> hw-&gt;highpulse.min_cnt) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    UART_MUTEX_UNLOCK</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> ret;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * To start detection of baud rate with the uart the auto_baud.en bit needs to be cleared and set. The bit period is </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * detected calling uartBadrateDetect(). The raw baudrate is computed using the UART_CLK_FREQ. The raw baudrate is </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * rounded to the closed real baudrate.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * ESP32-C3 reports wrong baud rate detection as shown below:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * This will help in a future recall for the C3.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * Baud Sent:          Baud Read:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> *  300        --&gt;       19536</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 2400        --&gt;       19536</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 4800        --&gt;       19536 </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 9600        --&gt;       28818 </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 19200       --&gt;       57678</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 38400       --&gt;       115440</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 57600       --&gt;       173535</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 115200      --&gt;       347826</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 230400      --&gt;       701754</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartStartDetectBaudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifdef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32C3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ESP32-C3 requires further testing</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Baud rate detection returns wrong values </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">   </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;ESP32-C3 baud rate detection is not supported.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Code bellow for C3 kept for future recall</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //hw-&gt;rx_filt.glitch_filt = 0x08;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //hw-&gt;rx_filt.glitch_filt_en = 1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //hw-&gt;conf0.autobaud_en = 0;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //hw-&gt;conf0.autobaud_en = 1;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#elif</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32S3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;ESP32-S3 baud rate detection is not supported.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    uart_dev_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">hw </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UART_LL_GET_HW</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    hw-&gt;auto_baud.glitch_filt </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> 0x</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">08</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    hw-&gt;auto_baud.en </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    hw-&gt;auto_baud.en </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">uartDetectBaudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">uart_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uart</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Baud rate detection only works for ESP32 and ESP32S2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ||</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32S2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    static</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> bool</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> uartStateDetectingBaudrate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">uartStateDetectingBaudrate) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">        uartStartDetectBaudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        uartStateDetectingBaudrate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> divisor </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uartBaudrateDetect</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">divisor) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">    uart_dev_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">hw </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UART_LL_GET_HW</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uart-&gt;num);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    hw-&gt;auto_baud.en </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    uartStateDetectingBaudrate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // Initialize for the next round</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> baudrate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> getApbFrequency</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> divisor;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //log_i(&quot;APB_FREQ = %d\\nraw baudrate detected = %d&quot;, getApbFrequency(), baudrate);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    static</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> unsigned</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> long</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> default_rates</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">[]</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> {</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">600</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">2400</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">4800</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">9600</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">19200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">38400</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">57600</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">74880</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">115200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">230400</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">256000</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">460800</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">921600</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1843200</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">3686400</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    size_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> i;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (i </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(default_rates) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">/</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> sizeof</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">default_rates</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// find the nearest real baudrate</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (baudrate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;=</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> default_rates</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[i])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (baudrate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> default_rates</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[i </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&lt;</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> default_rates</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[i] </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> baudrate) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">                i</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">            break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> default_rates</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">[i];</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#ifdef</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> CONFIG_IDF_TARGET_ESP32C3</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;ESP32-C3 baud rate detection is not supported.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">    log_e</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#032F62;">&quot;ESP32-S3 baud rate detection is not supported.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    These functions are for testing puspose only and can be used in Arduino Sketches</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    Those are used in the UART examples</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    This is intended to make an internal loopback connection using IOMUX</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    The function uart_internal_loopback() shall be used right after Arduino Serial.begin(...)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    This code &quot;replaces&quot; the physical wiring for connecting TX &lt;--&gt; RX in a loopback</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// gets the right TX SIGNAL, based on the UART number</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#if</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> SOC_UART_NUM</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> &gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UART_TX_SIGNAL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uartNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) (uartNumber </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_NUM_0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> U0TXD_OUT_IDX </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (uartNumber </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_NUM_1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> U1TXD_OUT_IDX </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> U2TXD_OUT_IDX))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#else</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#define</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> UART_TX_SIGNAL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">uartNumber</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) (uartNumber </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> UART_NUM_0 </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> U0TXD_OUT_IDX </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> U1TXD_OUT_IDX)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">#endif</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   Make sure UART&#39;s RX signal is connected to TX pin</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">   This creates a loop that lets us receive anything we send on the UART</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_internal_loopback</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uartNum</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> rxPin</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (uartNum </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> SOC_UART_NUM </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> ||</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> !</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">GPIO_IS_VALID_GPIO</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(rxPin)) </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  esp_rom_gpio_connect_out_signal</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(rxPin, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">UART_TX_SIGNAL</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uartNum), </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/*</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    This is intended to generate BREAK in an UART line</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Forces a BREAK in the line based on SERIAL_8N1 configuration at any baud rate</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_send_break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uartNum</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> currentBaudrate </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  uart_get_baudrate</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uartNum, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">currentBaudrate);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // calculates 10 bits of breaks in microseconds for baudrates up to 500mbps</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // This is very sensetive timing... it works fine for SERIAL_8N1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> breakTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint32_t</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">) (</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">10.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">1000000.0</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> /</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;"> currentBaudrate));</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  uart_set_line_inverse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uartNum, UART_SIGNAL_TXD_INV);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  ets_delay_us</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(breakTime);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;">  uart_set_line_inverse</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uartNum, UART_SIGNAL_INV_DISABLE);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Sends a buffer and at the end of the stream, it generates BREAK in the line</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_send_msg_with_break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> uartNum</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">uint8_t</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">size_t</span><span style="--shiki-light:#E36209;--shiki-dark:#E36209;"> msgSize</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 12 bits long BREAK for 8N1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#6F42C1;"> uart_write_bytes_with_break</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">(uartNum, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;">const</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> void</span><span style="--shiki-light:#D73A49;--shiki-dark:#D73A49;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">)msg, msgSize, </span><span style="--shiki-light:#005CC5;--shiki-dark:#005CC5;">12</span><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br><span class="line-number">569</span><br><span class="line-number">570</span><br><span class="line-number">571</span><br><span class="line-number">572</span><br><span class="line-number">573</span><br><span class="line-number">574</span><br><span class="line-number">575</span><br><span class="line-number">576</span><br><span class="line-number">577</span><br><span class="line-number">578</span><br><span class="line-number">579</span><br><span class="line-number">580</span><br><span class="line-number">581</span><br><span class="line-number">582</span><br><span class="line-number">583</span><br><span class="line-number">584</span><br><span class="line-number">585</span><br><span class="line-number">586</span><br><span class="line-number">587</span><br><span class="line-number">588</span><br><span class="line-number">589</span><br><span class="line-number">590</span><br><span class="line-number">591</span><br><span class="line-number">592</span><br><span class="line-number">593</span><br><span class="line-number">594</span><br><span class="line-number">595</span><br><span class="line-number">596</span><br><span class="line-number">597</span><br><span class="line-number">598</span><br><span class="line-number">599</span><br><span class="line-number">600</span><br><span class="line-number">601</span><br><span class="line-number">602</span><br><span class="line-number">603</span><br><span class="line-number">604</span><br><span class="line-number">605</span><br><span class="line-number">606</span><br><span class="line-number">607</span><br><span class="line-number">608</span><br><span class="line-number">609</span><br><span class="line-number">610</span><br><span class="line-number">611</span><br><span class="line-number">612</span><br><span class="line-number">613</span><br><span class="line-number">614</span><br><span class="line-number">615</span><br><span class="line-number">616</span><br><span class="line-number">617</span><br><span class="line-number">618</span><br><span class="line-number">619</span><br><span class="line-number">620</span><br><span class="line-number">621</span><br><span class="line-number">622</span><br><span class="line-number">623</span><br><span class="line-number">624</span><br><span class="line-number">625</span><br><span class="line-number">626</span><br><span class="line-number">627</span><br><span class="line-number">628</span><br><span class="line-number">629</span><br><span class="line-number">630</span><br><span class="line-number">631</span><br><span class="line-number">632</span><br><span class="line-number">633</span><br><span class="line-number">634</span><br><span class="line-number">635</span><br><span class="line-number">636</span><br><span class="line-number">637</span><br><span class="line-number">638</span><br><span class="line-number">639</span><br><span class="line-number">640</span><br><span class="line-number">641</span><br><span class="line-number">642</span><br><span class="line-number">643</span><br><span class="line-number">644</span><br><span class="line-number">645</span><br><span class="line-number">646</span><br><span class="line-number">647</span><br><span class="line-number">648</span><br><span class="line-number">649</span><br><span class="line-number">650</span><br><span class="line-number">651</span><br><span class="line-number">652</span><br><span class="line-number">653</span><br><span class="line-number">654</span><br><span class="line-number">655</span><br><span class="line-number">656</span><br><span class="line-number">657</span><br><span class="line-number">658</span><br><span class="line-number">659</span><br><span class="line-number">660</span><br><span class="line-number">661</span><br><span class="line-number">662</span><br><span class="line-number">663</span><br><span class="line-number">664</span><br><span class="line-number">665</span><br><span class="line-number">666</span><br><span class="line-number">667</span><br><span class="line-number">668</span><br><span class="line-number">669</span><br><span class="line-number">670</span><br><span class="line-number">671</span><br><span class="line-number">672</span><br><span class="line-number">673</span><br><span class="line-number">674</span><br><span class="line-number">675</span><br><span class="line-number">676</span><br><span class="line-number">677</span><br><span class="line-number">678</span><br><span class="line-number">679</span><br><span class="line-number">680</span><br><span class="line-number">681</span><br><span class="line-number">682</span><br><span class="line-number">683</span><br><span class="line-number">684</span><br><span class="line-number">685</span><br><span class="line-number">686</span><br><span class="line-number">687</span><br><span class="line-number">688</span><br><span class="line-number">689</span><br><span class="line-number">690</span><br><span class="line-number">691</span><br><span class="line-number">692</span><br><span class="line-number">693</span><br><span class="line-number">694</span><br><span class="line-number">695</span><br><span class="line-number">696</span><br><span class="line-number">697</span><br><span class="line-number">698</span><br><span class="line-number">699</span><br><span class="line-number">700</span><br><span class="line-number">701</span><br><span class="line-number">702</span><br><span class="line-number">703</span><br><span class="line-number">704</span><br><span class="line-number">705</span><br><span class="line-number">706</span><br><span class="line-number">707</span><br><span class="line-number">708</span><br><span class="line-number">709</span><br><span class="line-number">710</span><br><span class="line-number">711</span><br><span class="line-number">712</span><br><span class="line-number">713</span><br><span class="line-number">714</span><br><span class="line-number">715</span><br><span class="line-number">716</span><br><span class="line-number">717</span><br><span class="line-number">718</span><br><span class="line-number">719</span><br><span class="line-number">720</span><br><span class="line-number">721</span><br><span class="line-number">722</span><br><span class="line-number">723</span><br><span class="line-number">724</span><br><span class="line-number">725</span><br><span class="line-number">726</span><br><span class="line-number">727</span><br><span class="line-number">728</span><br><span class="line-number">729</span><br><span class="line-number">730</span><br><span class="line-number">731</span><br><span class="line-number">732</span><br><span class="line-number">733</span><br><span class="line-number">734</span><br><span class="line-number">735</span><br><span class="line-number">736</span><br><span class="line-number">737</span><br><span class="line-number">738</span><br><span class="line-number">739</span><br><span class="line-number">740</span><br><span class="line-number">741</span><br><span class="line-number">742</span><br><span class="line-number">743</span><br><span class="line-number">744</span><br><span class="line-number">745</span><br><span class="line-number">746</span><br><span class="line-number">747</span><br><span class="line-number">748</span><br><span class="line-number">749</span><br><span class="line-number">750</span><br><span class="line-number">751</span><br><span class="line-number">752</span><br><span class="line-number">753</span><br><span class="line-number">754</span><br><span class="line-number">755</span><br><span class="line-number">756</span><br><span class="line-number">757</span><br><span class="line-number">758</span><br><span class="line-number">759</span><br><span class="line-number">760</span><br><span class="line-number">761</span><br><span class="line-number">762</span><br><span class="line-number">763</span><br><span class="line-number">764</span><br><span class="line-number">765</span><br><span class="line-number">766</span><br><span class="line-number">767</span><br><span class="line-number">768</span><br><span class="line-number">769</span><br><span class="line-number">770</span><br><span class="line-number">771</span><br><span class="line-number">772</span><br><span class="line-number">773</span><br><span class="line-number">774</span><br><span class="line-number">775</span><br><span class="line-number">776</span><br><span class="line-number">777</span><br><span class="line-number">778</span><br><span class="line-number">779</span><br><span class="line-number">780</span><br><span class="line-number">781</span><br><span class="line-number">782</span><br><span class="line-number">783</span><br><span class="line-number">784</span><br><span class="line-number">785</span><br><span class="line-number">786</span><br><span class="line-number">787</span><br><span class="line-number">788</span><br><span class="line-number">789</span><br><span class="line-number">790</span><br><span class="line-number">791</span><br><span class="line-number">792</span><br><span class="line-number">793</span><br><span class="line-number">794</span><br><span class="line-number">795</span><br><span class="line-number">796</span><br><span class="line-number">797</span><br><span class="line-number">798</span><br><span class="line-number">799</span><br><span class="line-number">800</span><br><span class="line-number">801</span><br><span class="line-number">802</span><br><span class="line-number">803</span><br><span class="line-number">804</span><br><span class="line-number">805</span><br><span class="line-number">806</span><br><span class="line-number">807</span><br><span class="line-number">808</span><br><span class="line-number">809</span><br><span class="line-number">810</span><br><span class="line-number">811</span><br><span class="line-number">812</span><br><span class="line-number">813</span><br><span class="line-number">814</span><br><span class="line-number">815</span><br><span class="line-number">816</span><br><span class="line-number">817</span><br><span class="line-number">818</span><br></div></div></details><h2 id="参考文档" tabindex="-1">参考文档 <a class="header-anchor" href="#参考文档" aria-label="Permalink to &quot;参考文档&quot;">​</a></h2><p><a href="../public/datasheet/esp32-wroom-32_datasheet_cn.pdf">1. ESP32 datasheet 中文</a></p><p><a href="../public/datasheet/esp32-wroom-32_datasheet_en.pdf">2. ESP32 datasheet 英文</a></p><p><a href="../public/datasheet/cp2102.pdf">3. CP2102 datasheet</a></p><p><a href="../public/datasheet/esp32_devkitc_v4-sch.pdf">4. Devkit_v4</a></p><p><a href="../public/datasheet/esp32_hardware_design_guidelines_cn.pdf">5. Hardware Design</a></p><p><a href="../public/datasheet/esp32_technical_reference_manual_cn.pdf">6. Technical Reference</a></p>`,25)])])}const E=i(p,[["render",h]]);export{y as __pageData,E as default};
